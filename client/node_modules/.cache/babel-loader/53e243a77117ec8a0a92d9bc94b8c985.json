{"ast":null,"code":"// dedupe duplicated packages, or find them in the tree\nconst Arborist = require('@npmcli/arborist');\n\nconst reifyFinish = require('./utils/reify-finish.js');\n\nconst ArboristWorkspaceCmd = require('./workspaces/arborist-cmd.js');\n\nclass Dedupe extends ArboristWorkspaceCmd {\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get description() {\n    return 'Reduce duplication in the package tree';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get name() {\n    return 'dedupe';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get params() {\n    return ['global-style', 'legacy-bundling', 'strict-peer-deps', 'package-lock', 'omit', 'ignore-scripts', 'audit', 'bin-links', 'fund', 'dry-run', ...super.params];\n  }\n\n  exec(args, cb) {\n    this.dedupe(args).then(() => cb()).catch(cb);\n  }\n\n  async dedupe(args) {\n    if (this.npm.config.get('global')) {\n      const er = new Error('`npm dedupe` does not work in global mode.');\n      er.code = 'EDEDUPEGLOBAL';\n      throw er;\n    }\n\n    const dryRun = this.npm.config.get('dry-run');\n    const where = this.npm.prefix;\n    const opts = { ...this.npm.flatOptions,\n      log: this.npm.log,\n      path: where,\n      dryRun,\n      workspaces: this.workspaceNames\n    };\n    const arb = new Arborist(opts);\n    await arb.dedupe(opts);\n    await reifyFinish(this.npm, arb);\n  }\n\n}\n\nmodule.exports = Dedupe;","map":{"version":3,"sources":["C:/Users/ghedi/Documents/GhedBlog/node_modules/npm/lib/dedupe.js"],"names":["Arborist","require","reifyFinish","ArboristWorkspaceCmd","Dedupe","description","name","params","exec","args","cb","dedupe","then","catch","npm","config","get","er","Error","code","dryRun","where","prefix","opts","flatOptions","log","path","workspaces","workspaceNames","arb","module","exports"],"mappings":"AAAA;AACA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,kBAAD,CAAxB;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAC,yBAAD,CAA3B;;AAEA,MAAME,oBAAoB,GAAGF,OAAO,CAAC,8BAAD,CAApC;;AAEA,MAAMG,MAAN,SAAqBD,oBAArB,CAA0C;AACxC;AACsB,aAAXE,WAAW,GAAI;AACxB,WAAO,wCAAP;AACD;AAED;;;AACe,aAAJC,IAAI,GAAI;AACjB,WAAO,QAAP;AACD;AAED;;;AACiB,aAANC,MAAM,GAAI;AACnB,WAAO,CACL,cADK,EAEL,iBAFK,EAGL,kBAHK,EAIL,cAJK,EAKL,MALK,EAML,gBANK,EAOL,OAPK,EAQL,WARK,EASL,MATK,EAUL,SAVK,EAWL,GAAG,MAAMA,MAXJ,CAAP;AAaD;;AAEDC,EAAAA,IAAI,CAAEC,IAAF,EAAQC,EAAR,EAAY;AACd,SAAKC,MAAL,CAAYF,IAAZ,EAAkBG,IAAlB,CAAuB,MAAMF,EAAE,EAA/B,EAAmCG,KAAnC,CAAyCH,EAAzC;AACD;;AAEW,QAANC,MAAM,CAAEF,IAAF,EAAQ;AAClB,QAAI,KAAKK,GAAL,CAASC,MAAT,CAAgBC,GAAhB,CAAoB,QAApB,CAAJ,EAAmC;AACjC,YAAMC,EAAE,GAAG,IAAIC,KAAJ,CAAU,4CAAV,CAAX;AACAD,MAAAA,EAAE,CAACE,IAAH,GAAU,eAAV;AACA,YAAMF,EAAN;AACD;;AAED,UAAMG,MAAM,GAAG,KAAKN,GAAL,CAASC,MAAT,CAAgBC,GAAhB,CAAoB,SAApB,CAAf;AACA,UAAMK,KAAK,GAAG,KAAKP,GAAL,CAASQ,MAAvB;AACA,UAAMC,IAAI,GAAG,EACX,GAAG,KAAKT,GAAL,CAASU,WADD;AAEXC,MAAAA,GAAG,EAAE,KAAKX,GAAL,CAASW,GAFH;AAGXC,MAAAA,IAAI,EAAEL,KAHK;AAIXD,MAAAA,MAJW;AAKXO,MAAAA,UAAU,EAAE,KAAKC;AALN,KAAb;AAOA,UAAMC,GAAG,GAAG,IAAI7B,QAAJ,CAAauB,IAAb,CAAZ;AACA,UAAMM,GAAG,CAAClB,MAAJ,CAAWY,IAAX,CAAN;AACA,UAAMrB,WAAW,CAAC,KAAKY,GAAN,EAAWe,GAAX,CAAjB;AACD;;AAnDuC;;AAsD1CC,MAAM,CAACC,OAAP,GAAiB3B,MAAjB","sourcesContent":["// dedupe duplicated packages, or find them in the tree\nconst Arborist = require('@npmcli/arborist')\nconst reifyFinish = require('./utils/reify-finish.js')\n\nconst ArboristWorkspaceCmd = require('./workspaces/arborist-cmd.js')\n\nclass Dedupe extends ArboristWorkspaceCmd {\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get description () {\n    return 'Reduce duplication in the package tree'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get name () {\n    return 'dedupe'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params () {\n    return [\n      'global-style',\n      'legacy-bundling',\n      'strict-peer-deps',\n      'package-lock',\n      'omit',\n      'ignore-scripts',\n      'audit',\n      'bin-links',\n      'fund',\n      'dry-run',\n      ...super.params,\n    ]\n  }\n\n  exec (args, cb) {\n    this.dedupe(args).then(() => cb()).catch(cb)\n  }\n\n  async dedupe (args) {\n    if (this.npm.config.get('global')) {\n      const er = new Error('`npm dedupe` does not work in global mode.')\n      er.code = 'EDEDUPEGLOBAL'\n      throw er\n    }\n\n    const dryRun = this.npm.config.get('dry-run')\n    const where = this.npm.prefix\n    const opts = {\n      ...this.npm.flatOptions,\n      log: this.npm.log,\n      path: where,\n      dryRun,\n      workspaces: this.workspaceNames,\n    }\n    const arb = new Arborist(opts)\n    await arb.dedupe(opts)\n    await reifyFinish(this.npm, arb)\n  }\n}\n\nmodule.exports = Dedupe\n"]},"metadata":{},"sourceType":"script"}