{"ast":null,"code":"// npm view [pkg [pkg ...]]\nconst color = require('ansicolors');\n\nconst columns = require('cli-columns');\n\nconst fs = require('fs');\n\nconst jsonParse = require('json-parse-even-better-errors');\n\nconst log = require('npmlog');\n\nconst npa = require('npm-package-arg');\n\nconst {\n  resolve\n} = require('path');\n\nconst formatBytes = require('./utils/format-bytes.js');\n\nconst relativeDate = require('tiny-relative-date');\n\nconst semver = require('semver');\n\nconst style = require('ansistyles');\n\nconst {\n  inspect,\n  promisify\n} = require('util');\n\nconst {\n  packument\n} = require('pacote');\n\nconst readFile = promisify(fs.readFile);\n\nconst readJson = async file => jsonParse(await readFile(file, 'utf8'));\n\nconst Queryable = require('./utils/queryable.js');\n\nconst BaseCommand = require('./base-command.js');\n\nclass View extends BaseCommand {\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get description() {\n    return 'View registry info';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get params() {\n    return ['json', 'workspace', 'workspaces'];\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get name() {\n    return 'view';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get usage() {\n    return ['[<@scope>/]<pkg>[@<version>] [<field>[.subfield]...]'];\n  }\n\n  async completion(opts) {\n    if (opts.conf.argv.remain.length <= 2) {\n      // There used to be registry completion here, but it stopped\n      // making sense somewhere around 50,000 packages on the registry\n      return;\n    } // have the package, get the fields\n\n\n    const config = { ...this.npm.flatOptions,\n      fullMetadata: true,\n      preferOnline: true\n    };\n    const spec = npa(opts.conf.argv.remain[2]);\n    const pckmnt = await packument(spec, config);\n    const defaultTag = this.npm.config.get('tag');\n    const dv = pckmnt.versions[pckmnt['dist-tags'][defaultTag]];\n    pckmnt.versions = Object.keys(pckmnt.versions).sort(semver.compareLoose);\n    return getFields(pckmnt).concat(getFields(dv));\n\n    function getFields(d, f, pref) {\n      f = f || [];\n      if (!d) return f;\n      pref = pref || [];\n      Object.keys(d).forEach(k => {\n        if (k.charAt(0) === '_' || k.indexOf('.') !== -1) return;\n        const p = pref.concat(k).join('.');\n        f.push(p);\n\n        if (Array.isArray(d[k])) {\n          d[k].forEach((val, i) => {\n            const pi = p + '[' + i + ']';\n            if (val && typeof val === 'object') getFields(val, f, [p]);else f.push(pi);\n          });\n          return;\n        }\n\n        if (typeof d[k] === 'object') getFields(d[k], f, [p]);\n      });\n      return f;\n    }\n  }\n\n  exec(args, cb) {\n    this.view(args).then(() => cb()).catch(cb);\n  }\n\n  execWorkspaces(args, filters, cb) {\n    this.viewWorkspaces(args, filters).then(() => cb()).catch(cb);\n  }\n\n  async view(args) {\n    if (!args.length) args = ['.'];\n    let pkg = args.shift();\n    const local = /^\\.@/.test(pkg) || pkg === '.';\n\n    if (local) {\n      if (this.npm.config.get('global')) throw new Error('Cannot use view command in global mode.');\n      const dir = this.npm.prefix;\n      const manifest = await readJson(resolve(dir, 'package.json'));\n      if (!manifest.name) throw new Error('Invalid package.json, no \"name\" field'); // put the version back if it existed\n\n      pkg = `${manifest.name}${pkg.slice(1)}`;\n    }\n\n    let wholePackument = false;\n\n    if (!args.length) {\n      args = [''];\n      wholePackument = true;\n    }\n\n    const [pckmnt, data] = await this.getData(pkg, args);\n\n    if (!this.npm.config.get('json') && wholePackument) {\n      // pretty view (entire packument)\n      data.map(v => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']));\n    } else {\n      // JSON formatted output (JSON or specific attributes from packument)\n      let reducedData = data.reduce(reducer, {});\n\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData);\n        log.silly('view', reducedData);\n      } // disable the progress bar entirely, as we can't meaningfully update it\n      // if we may have partial lines printed.\n\n\n      log.disableProgress();\n      const msg = await this.jsonData(reducedData, pckmnt._id);\n      if (msg !== '') console.log(msg);\n    }\n  }\n\n  async viewWorkspaces(args, filters) {\n    if (!args.length) args = ['.'];\n    const pkg = args.shift();\n    const local = /^\\.@/.test(pkg) || pkg === '.';\n\n    if (!local) {\n      this.npm.log.warn('Ignoring workspaces for specified package(s)');\n      return this.view([pkg, ...args]);\n    }\n\n    let wholePackument = false;\n\n    if (!args.length) {\n      wholePackument = true;\n      args = ['']; // getData relies on this\n    }\n\n    const results = {};\n    await this.setWorkspaces(filters);\n\n    for (const name of this.workspaceNames) {\n      const wsPkg = `${name}${pkg.slice(1)}`;\n      const [pckmnt, data] = await this.getData(wsPkg, args);\n      let reducedData = data.reduce(reducer, {});\n\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData);\n        log.silly('view', reducedData);\n      }\n\n      if (!this.npm.config.get('json')) {\n        if (wholePackument) data.map(v => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']));else {\n          console.log(`${name}:`);\n          const msg = await this.jsonData(reducedData, pckmnt._id);\n          if (msg !== '') console.log(msg);\n        }\n      } else {\n        const msg = await this.jsonData(reducedData, pckmnt._id);\n        if (msg !== '') results[name] = JSON.parse(msg);\n      }\n    }\n\n    if (Object.keys(results).length > 0) console.log(JSON.stringify(results, null, 2));\n  }\n\n  async getData(pkg, args) {\n    const opts = { ...this.npm.flatOptions,\n      preferOnline: true,\n      fullMetadata: true\n    };\n    const spec = npa(pkg); // get the data about this package\n\n    let version = this.npm.config.get('tag'); // rawSpec is the git url if this is from git\n\n    if (spec.type !== 'git' && spec.rawSpec) version = spec.rawSpec;\n    const pckmnt = await packument(spec, opts);\n    if (pckmnt['dist-tags'] && pckmnt['dist-tags'][version]) version = pckmnt['dist-tags'][version];\n\n    if (pckmnt.time && pckmnt.time.unpublished) {\n      const u = pckmnt.time.unpublished;\n      const er = new Error('Unpublished by ' + u.name + ' on ' + u.time);\n      er.statusCode = 404;\n      er.code = 'E404';\n      er.pkgid = pckmnt._id;\n      throw er;\n    }\n\n    const data = [];\n    const versions = pckmnt.versions || {};\n    pckmnt.versions = Object.keys(versions).sort(semver.compareLoose); // remove readme unless we asked for it\n\n    if (args.indexOf('readme') === -1) delete pckmnt.readme;\n    Object.keys(versions).forEach(v => {\n      if (semver.satisfies(v, version, true)) {\n        args.forEach(arg => {\n          // remove readme unless we asked for it\n          if (args.indexOf('readme') !== -1) delete versions[v].readme;\n          data.push(showFields(pckmnt, versions[v], arg));\n        });\n      }\n    });\n    if (!this.npm.config.get('json') && args.length === 1 && args[0] === '') pckmnt.version = version;\n    return [pckmnt, data];\n  }\n\n  async jsonData(data, name) {\n    const versions = Object.keys(data);\n    let msg = '';\n    let msgJson = [];\n    const includeVersions = versions.length > 1;\n    let includeFields;\n    const json = this.npm.config.get('json');\n    versions.forEach(v => {\n      const fields = Object.keys(data[v]);\n      includeFields = includeFields || fields.length > 1;\n      if (json) msgJson.push({});\n      fields.forEach(f => {\n        let d = cleanup(data[v][f]);\n        if (fields.length === 1 && json) msgJson[msgJson.length - 1][f] = d;\n\n        if (includeVersions || includeFields || typeof d !== 'string') {\n          if (json) msgJson[msgJson.length - 1][f] = d;else {\n            d = inspect(d, {\n              showHidden: false,\n              depth: 5,\n              colors: this.npm.color,\n              maxArrayLength: null\n            });\n          }\n        } else if (typeof d === 'string' && json) d = JSON.stringify(d);\n\n        if (!json) {\n          if (f && includeFields) f += ' = ';\n          msg += (includeVersions ? name + '@' + v + ' ' : '') + (includeFields ? f : '') + d + '\\n';\n        }\n      });\n    });\n\n    if (json) {\n      if (msgJson.length && Object.keys(msgJson[0]).length === 1) {\n        const k = Object.keys(msgJson[0])[0];\n        msgJson = msgJson.map(m => m[k]);\n      }\n\n      if (msgJson.length === 1) msg = JSON.stringify(msgJson[0], null, 2) + '\\n';else if (msgJson.length > 1) msg = JSON.stringify(msgJson, null, 2) + '\\n';\n    }\n\n    return msg.trim();\n  }\n\n  prettyView(packument, manifest) {\n    // More modern, pretty printing of default view\n    const unicode = this.npm.config.get('unicode');\n    const tags = [];\n    Object.keys(packument['dist-tags']).forEach(t => {\n      const version = packument['dist-tags'][t];\n      tags.push(`${style.bright(color.green(t))}: ${version}`);\n    });\n    const unpackedSize = manifest.dist.unpackedSize && formatBytes(manifest.dist.unpackedSize, true);\n    const licenseField = manifest.license || 'Proprietary';\n    const info = {\n      name: color.green(manifest.name),\n      version: color.green(manifest.version),\n      bins: Object.keys(manifest.bin || {}).map(color.yellow),\n      versions: color.yellow(packument.versions.length + ''),\n      description: manifest.description,\n      deprecated: manifest.deprecated,\n      keywords: (packument.keywords || []).map(color.yellow),\n      license: typeof licenseField === 'string' ? licenseField : licenseField.type || 'Proprietary',\n      deps: Object.keys(manifest.dependencies || {}).map(dep => {\n        return `${color.yellow(dep)}: ${manifest.dependencies[dep]}`;\n      }),\n      publisher: manifest._npmUser && unparsePerson({\n        name: color.yellow(manifest._npmUser.name),\n        email: color.cyan(manifest._npmUser.email)\n      }),\n      modified: !packument.time ? undefined : color.yellow(relativeDate(packument.time[manifest.version])),\n      maintainers: (packument.maintainers || []).map(u => unparsePerson({\n        name: color.yellow(u.name),\n        email: color.cyan(u.email)\n      })),\n      repo: manifest.bugs && (manifest.bugs.url || manifest.bugs) || manifest.repository && (manifest.repository.url || manifest.repository),\n      site: manifest.homepage && (manifest.homepage.url || manifest.homepage),\n      tags,\n      tarball: color.cyan(manifest.dist.tarball),\n      shasum: color.yellow(manifest.dist.shasum),\n      integrity: manifest.dist.integrity && color.yellow(manifest.dist.integrity),\n      fileCount: manifest.dist.fileCount && color.yellow(manifest.dist.fileCount),\n      unpackedSize: unpackedSize && color.yellow(unpackedSize)\n    };\n    if (info.license.toLowerCase().trim() === 'proprietary') info.license = style.bright(color.red(info.license));else info.license = color.green(info.license);\n    console.log('');\n    console.log(style.underline(style.bright(`${info.name}@${info.version}`)) + ' | ' + info.license + ' | deps: ' + (info.deps.length ? color.cyan(info.deps.length) : color.green('none')) + ' | versions: ' + info.versions);\n    info.description && console.log(info.description);\n    if (info.repo || info.site) info.site && console.log(color.cyan(info.site));\n    const warningSign = unicode ? ' ⚠️ ' : '!!';\n    info.deprecated && console.log(`\\n${style.bright(color.red('DEPRECATED'))}${warningSign} - ${info.deprecated}`);\n\n    if (info.keywords.length) {\n      console.log('');\n      console.log('keywords:', info.keywords.join(', '));\n    }\n\n    if (info.bins.length) {\n      console.log('');\n      console.log('bin:', info.bins.join(', '));\n    }\n\n    console.log('');\n    console.log('dist');\n    console.log('.tarball:', info.tarball);\n    console.log('.shasum:', info.shasum);\n    info.integrity && console.log('.integrity:', info.integrity);\n    info.unpackedSize && console.log('.unpackedSize:', info.unpackedSize);\n    const maxDeps = 24;\n\n    if (info.deps.length) {\n      console.log('');\n      console.log('dependencies:');\n      console.log(columns(info.deps.slice(0, maxDeps), {\n        padding: 1\n      }));\n      if (info.deps.length > maxDeps) console.log(`(...and ${info.deps.length - maxDeps} more.)`);\n    }\n\n    if (info.maintainers && info.maintainers.length) {\n      console.log('');\n      console.log('maintainers:');\n      info.maintainers.forEach(u => console.log('-', u));\n    }\n\n    console.log('');\n    console.log('dist-tags:');\n    console.log(columns(info.tags));\n\n    if (info.publisher || info.modified) {\n      let publishInfo = 'published';\n      if (info.modified) publishInfo += ` ${info.modified}`;\n      if (info.publisher) publishInfo += ` by ${info.publisher}`;\n      console.log('');\n      console.log(publishInfo);\n    }\n  }\n\n}\n\nmodule.exports = View;\n\nfunction cleanBlanks(obj) {\n  const clean = {};\n  Object.keys(obj).forEach(version => {\n    clean[version] = obj[version][''];\n  });\n  return clean;\n} // takes an array of objects and merges them into one object\n\n\nfunction reducer(acc, cur) {\n  if (cur) {\n    Object.keys(cur).forEach(v => {\n      acc[v] = acc[v] || {};\n      Object.keys(cur[v]).forEach(t => {\n        acc[v][t] = cur[v][t];\n      });\n    });\n  }\n\n  return acc;\n} // return whatever was printed\n\n\nfunction showFields(data, version, fields) {\n  const o = {};\n  [data, version].forEach(s => {\n    Object.keys(s).forEach(k => {\n      o[k] = s[k];\n    });\n  });\n  const queryable = new Queryable(o);\n  const s = queryable.query(fields);\n  const res = {\n    [version.version]: s\n  };\n  if (s) return res;\n}\n\nfunction cleanup(data) {\n  if (Array.isArray(data)) return data.map(cleanup);\n  if (!data || typeof data !== 'object') return data;\n  const keys = Object.keys(data);\n  if (keys.length <= 3 && data.name && (keys.length === 1 || keys.length === 3 && data.email && data.url || keys.length === 2 && (data.email || data.url))) data = unparsePerson(data);\n  return data;\n}\n\nfunction unparsePerson(d) {\n  return d.name + (d.email ? ' <' + d.email + '>' : '') + (d.url ? ' (' + d.url + ')' : '');\n}","map":{"version":3,"sources":["C:/Users/ghedi/Documents/GhedBlog/node_modules/npm/lib/view.js"],"names":["color","require","columns","fs","jsonParse","log","npa","resolve","formatBytes","relativeDate","semver","style","inspect","promisify","packument","readFile","readJson","file","Queryable","BaseCommand","View","description","params","name","usage","completion","opts","conf","argv","remain","length","config","npm","flatOptions","fullMetadata","preferOnline","spec","pckmnt","defaultTag","get","dv","versions","Object","keys","sort","compareLoose","getFields","concat","d","f","pref","forEach","k","charAt","indexOf","p","join","push","Array","isArray","val","i","pi","exec","args","cb","view","then","catch","execWorkspaces","filters","viewWorkspaces","pkg","shift","local","test","Error","dir","prefix","manifest","slice","wholePackument","data","getData","map","v","prettyView","reducedData","reduce","reducer","cleanBlanks","silly","disableProgress","msg","jsonData","_id","console","warn","results","setWorkspaces","workspaceNames","wsPkg","JSON","parse","stringify","version","type","rawSpec","time","unpublished","u","er","statusCode","code","pkgid","readme","satisfies","arg","showFields","msgJson","includeVersions","includeFields","json","fields","cleanup","showHidden","depth","colors","maxArrayLength","m","trim","unicode","tags","t","bright","green","unpackedSize","dist","licenseField","license","info","bins","bin","yellow","deprecated","keywords","deps","dependencies","dep","publisher","_npmUser","unparsePerson","email","cyan","modified","undefined","maintainers","repo","bugs","url","repository","site","homepage","tarball","shasum","integrity","fileCount","toLowerCase","red","underline","warningSign","maxDeps","padding","publishInfo","module","exports","obj","clean","acc","cur","o","s","queryable","query","res"],"mappings":"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","sourcesContent":["// npm view [pkg [pkg ...]]\n\nconst color = require('ansicolors')\nconst columns = require('cli-columns')\nconst fs = require('fs')\nconst jsonParse = require('json-parse-even-better-errors')\nconst log = require('npmlog')\nconst npa = require('npm-package-arg')\nconst { resolve } = require('path')\nconst formatBytes = require('./utils/format-bytes.js')\nconst relativeDate = require('tiny-relative-date')\nconst semver = require('semver')\nconst style = require('ansistyles')\nconst { inspect, promisify } = require('util')\nconst { packument } = require('pacote')\n\nconst readFile = promisify(fs.readFile)\nconst readJson = async file => jsonParse(await readFile(file, 'utf8'))\n\nconst Queryable = require('./utils/queryable.js')\nconst BaseCommand = require('./base-command.js')\nclass View extends BaseCommand {\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get description () {\n    return 'View registry info'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params () {\n    return [\n      'json',\n      'workspace',\n      'workspaces',\n    ]\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get name () {\n    return 'view'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get usage () {\n    return ['[<@scope>/]<pkg>[@<version>] [<field>[.subfield]...]']\n  }\n\n  async completion (opts) {\n    if (opts.conf.argv.remain.length <= 2) {\n      // There used to be registry completion here, but it stopped\n      // making sense somewhere around 50,000 packages on the registry\n      return\n    }\n    // have the package, get the fields\n    const config = {\n      ...this.npm.flatOptions,\n      fullMetadata: true,\n      preferOnline: true,\n    }\n    const spec = npa(opts.conf.argv.remain[2])\n    const pckmnt = await packument(spec, config)\n    const defaultTag = this.npm.config.get('tag')\n    const dv = pckmnt.versions[pckmnt['dist-tags'][defaultTag]]\n    pckmnt.versions = Object.keys(pckmnt.versions).sort(semver.compareLoose)\n\n    return getFields(pckmnt).concat(getFields(dv))\n\n    function getFields (d, f, pref) {\n      f = f || []\n      if (!d)\n        return f\n      pref = pref || []\n      Object.keys(d).forEach((k) => {\n        if (k.charAt(0) === '_' || k.indexOf('.') !== -1)\n          return\n        const p = pref.concat(k).join('.')\n        f.push(p)\n        if (Array.isArray(d[k])) {\n          d[k].forEach((val, i) => {\n            const pi = p + '[' + i + ']'\n            if (val && typeof val === 'object')\n              getFields(val, f, [p])\n            else\n              f.push(pi)\n          })\n          return\n        }\n        if (typeof d[k] === 'object')\n          getFields(d[k], f, [p])\n      })\n      return f\n    }\n  }\n\n  exec (args, cb) {\n    this.view(args).then(() => cb()).catch(cb)\n  }\n\n  execWorkspaces (args, filters, cb) {\n    this.viewWorkspaces(args, filters).then(() => cb()).catch(cb)\n  }\n\n  async view (args) {\n    if (!args.length)\n      args = ['.']\n    let pkg = args.shift()\n    const local = /^\\.@/.test(pkg) || pkg === '.'\n\n    if (local) {\n      if (this.npm.config.get('global'))\n        throw new Error('Cannot use view command in global mode.')\n      const dir = this.npm.prefix\n      const manifest = await readJson(resolve(dir, 'package.json'))\n      if (!manifest.name)\n        throw new Error('Invalid package.json, no \"name\" field')\n      // put the version back if it existed\n      pkg = `${manifest.name}${pkg.slice(1)}`\n    }\n    let wholePackument = false\n    if (!args.length) {\n      args = ['']\n      wholePackument = true\n    }\n    const [pckmnt, data] = await this.getData(pkg, args)\n\n    if (!this.npm.config.get('json') && wholePackument) {\n      // pretty view (entire packument)\n      data.map((v) => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']))\n    } else {\n      // JSON formatted output (JSON or specific attributes from packument)\n      let reducedData = data.reduce(reducer, {})\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData)\n        log.silly('view', reducedData)\n      }\n      // disable the progress bar entirely, as we can't meaningfully update it\n      // if we may have partial lines printed.\n      log.disableProgress()\n\n      const msg = await this.jsonData(reducedData, pckmnt._id)\n      if (msg !== '')\n        console.log(msg)\n    }\n  }\n\n  async viewWorkspaces (args, filters) {\n    if (!args.length)\n      args = ['.']\n\n    const pkg = args.shift()\n\n    const local = /^\\.@/.test(pkg) || pkg === '.'\n    if (!local) {\n      this.npm.log.warn('Ignoring workspaces for specified package(s)')\n      return this.view([pkg, ...args])\n    }\n    let wholePackument = false\n    if (!args.length) {\n      wholePackument = true\n      args = [''] // getData relies on this\n    }\n    const results = {}\n    await this.setWorkspaces(filters)\n    for (const name of this.workspaceNames) {\n      const wsPkg = `${name}${pkg.slice(1)}`\n      const [pckmnt, data] = await this.getData(wsPkg, args)\n\n      let reducedData = data.reduce(reducer, {})\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData)\n        log.silly('view', reducedData)\n      }\n\n      if (!this.npm.config.get('json')) {\n        if (wholePackument)\n          data.map((v) => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']))\n        else {\n          console.log(`${name}:`)\n          const msg = await this.jsonData(reducedData, pckmnt._id)\n          if (msg !== '')\n            console.log(msg)\n        }\n      } else {\n        const msg = await this.jsonData(reducedData, pckmnt._id)\n        if (msg !== '')\n          results[name] = JSON.parse(msg)\n      }\n    }\n    if (Object.keys(results).length > 0)\n      console.log(JSON.stringify(results, null, 2))\n  }\n\n  async getData (pkg, args) {\n    const opts = {\n      ...this.npm.flatOptions,\n      preferOnline: true,\n      fullMetadata: true,\n    }\n\n    const spec = npa(pkg)\n\n    // get the data about this package\n    let version = this.npm.config.get('tag')\n    // rawSpec is the git url if this is from git\n    if (spec.type !== 'git' && spec.rawSpec)\n      version = spec.rawSpec\n\n    const pckmnt = await packument(spec, opts)\n\n    if (pckmnt['dist-tags'] && pckmnt['dist-tags'][version])\n      version = pckmnt['dist-tags'][version]\n\n    if (pckmnt.time && pckmnt.time.unpublished) {\n      const u = pckmnt.time.unpublished\n      const er = new Error('Unpublished by ' + u.name + ' on ' + u.time)\n      er.statusCode = 404\n      er.code = 'E404'\n      er.pkgid = pckmnt._id\n      throw er\n    }\n\n    const data = []\n    const versions = pckmnt.versions || {}\n    pckmnt.versions = Object.keys(versions).sort(semver.compareLoose)\n\n    // remove readme unless we asked for it\n    if (args.indexOf('readme') === -1)\n      delete pckmnt.readme\n\n    Object.keys(versions).forEach((v) => {\n      if (semver.satisfies(v, version, true)) {\n        args.forEach(arg => {\n          // remove readme unless we asked for it\n          if (args.indexOf('readme') !== -1)\n            delete versions[v].readme\n\n          data.push(showFields(pckmnt, versions[v], arg))\n        })\n      }\n    })\n\n    if (\n      !this.npm.config.get('json') &&\n      args.length === 1 &&\n      args[0] === ''\n    )\n      pckmnt.version = version\n\n    return [pckmnt, data]\n  }\n\n  async jsonData (data, name) {\n    const versions = Object.keys(data)\n    let msg = ''\n    let msgJson = []\n    const includeVersions = versions.length > 1\n    let includeFields\n    const json = this.npm.config.get('json')\n\n    versions.forEach((v) => {\n      const fields = Object.keys(data[v])\n      includeFields = includeFields || (fields.length > 1)\n      if (json)\n        msgJson.push({})\n      fields.forEach((f) => {\n        let d = cleanup(data[v][f])\n        if (fields.length === 1 && json)\n          msgJson[msgJson.length - 1][f] = d\n\n        if (includeVersions || includeFields || typeof d !== 'string') {\n          if (json)\n            msgJson[msgJson.length - 1][f] = d\n          else {\n            d = inspect(d, {\n              showHidden: false,\n              depth: 5,\n              colors: this.npm.color,\n              maxArrayLength: null,\n            })\n          }\n        } else if (typeof d === 'string' && json)\n          d = JSON.stringify(d)\n\n        if (!json) {\n          if (f && includeFields)\n            f += ' = '\n          msg += (includeVersions ? name + '@' + v + ' ' : '') +\n            (includeFields ? f : '') + d + '\\n'\n        }\n      })\n    })\n\n    if (json) {\n      if (msgJson.length && Object.keys(msgJson[0]).length === 1) {\n        const k = Object.keys(msgJson[0])[0]\n        msgJson = msgJson.map(m => m[k])\n      }\n      if (msgJson.length === 1)\n        msg = JSON.stringify(msgJson[0], null, 2) + '\\n'\n      else if (msgJson.length > 1)\n        msg = JSON.stringify(msgJson, null, 2) + '\\n'\n    }\n\n    return msg.trim()\n  }\n\n  prettyView (packument, manifest) {\n    // More modern, pretty printing of default view\n    const unicode = this.npm.config.get('unicode')\n    const tags = []\n\n    Object.keys(packument['dist-tags']).forEach((t) => {\n      const version = packument['dist-tags'][t]\n      tags.push(`${style.bright(color.green(t))}: ${version}`)\n    })\n    const unpackedSize = manifest.dist.unpackedSize &&\n      formatBytes(manifest.dist.unpackedSize, true)\n    const licenseField = manifest.license || 'Proprietary'\n    const info = {\n      name: color.green(manifest.name),\n      version: color.green(manifest.version),\n      bins: Object.keys(manifest.bin || {}).map(color.yellow),\n      versions: color.yellow(packument.versions.length + ''),\n      description: manifest.description,\n      deprecated: manifest.deprecated,\n      keywords: (packument.keywords || []).map(color.yellow),\n      license: typeof licenseField === 'string'\n        ? licenseField\n        : (licenseField.type || 'Proprietary'),\n      deps: Object.keys(manifest.dependencies || {}).map((dep) => {\n        return `${color.yellow(dep)}: ${manifest.dependencies[dep]}`\n      }),\n      publisher: manifest._npmUser && unparsePerson({\n        name: color.yellow(manifest._npmUser.name),\n        email: color.cyan(manifest._npmUser.email),\n      }),\n      modified: !packument.time ? undefined\n      : color.yellow(relativeDate(packument.time[manifest.version])),\n      maintainers: (packument.maintainers || []).map((u) => unparsePerson({\n        name: color.yellow(u.name),\n        email: color.cyan(u.email),\n      })),\n      repo: (\n        manifest.bugs && (manifest.bugs.url || manifest.bugs)\n      ) || (\n        manifest.repository && (manifest.repository.url || manifest.repository)\n      ),\n      site: (\n        manifest.homepage && (manifest.homepage.url || manifest.homepage)\n      ),\n      tags,\n      tarball: color.cyan(manifest.dist.tarball),\n      shasum: color.yellow(manifest.dist.shasum),\n      integrity:\n        manifest.dist.integrity && color.yellow(manifest.dist.integrity),\n      fileCount:\n        manifest.dist.fileCount && color.yellow(manifest.dist.fileCount),\n      unpackedSize: unpackedSize && color.yellow(unpackedSize),\n    }\n    if (info.license.toLowerCase().trim() === 'proprietary')\n      info.license = style.bright(color.red(info.license))\n    else\n      info.license = color.green(info.license)\n\n    console.log('')\n    console.log(\n      style.underline(style.bright(`${info.name}@${info.version}`)) +\n      ' | ' + info.license +\n      ' | deps: ' + (info.deps.length ? color.cyan(info.deps.length) : color.green('none')) +\n      ' | versions: ' + info.versions\n    )\n    info.description && console.log(info.description)\n    if (info.repo || info.site)\n      info.site && console.log(color.cyan(info.site))\n\n    const warningSign = unicode ? ' ⚠️ ' : '!!'\n    info.deprecated && console.log(\n      `\\n${style.bright(color.red('DEPRECATED'))}${\n      warningSign\n    } - ${info.deprecated}`\n    )\n\n    if (info.keywords.length) {\n      console.log('')\n      console.log('keywords:', info.keywords.join(', '))\n    }\n\n    if (info.bins.length) {\n      console.log('')\n      console.log('bin:', info.bins.join(', '))\n    }\n\n    console.log('')\n    console.log('dist')\n    console.log('.tarball:', info.tarball)\n    console.log('.shasum:', info.shasum)\n    info.integrity && console.log('.integrity:', info.integrity)\n    info.unpackedSize && console.log('.unpackedSize:', info.unpackedSize)\n\n    const maxDeps = 24\n    if (info.deps.length) {\n      console.log('')\n      console.log('dependencies:')\n      console.log(columns(info.deps.slice(0, maxDeps), { padding: 1 }))\n      if (info.deps.length > maxDeps)\n        console.log(`(...and ${info.deps.length - maxDeps} more.)`)\n    }\n\n    if (info.maintainers && info.maintainers.length) {\n      console.log('')\n      console.log('maintainers:')\n      info.maintainers.forEach((u) => console.log('-', u))\n    }\n\n    console.log('')\n    console.log('dist-tags:')\n    console.log(columns(info.tags))\n\n    if (info.publisher || info.modified) {\n      let publishInfo = 'published'\n      if (info.modified)\n        publishInfo += ` ${info.modified}`\n      if (info.publisher)\n        publishInfo += ` by ${info.publisher}`\n      console.log('')\n      console.log(publishInfo)\n    }\n  }\n}\nmodule.exports = View\n\nfunction cleanBlanks (obj) {\n  const clean = {}\n  Object.keys(obj).forEach((version) => {\n    clean[version] = obj[version]['']\n  })\n  return clean\n}\n\n// takes an array of objects and merges them into one object\nfunction reducer (acc, cur) {\n  if (cur) {\n    Object.keys(cur).forEach((v) => {\n      acc[v] = acc[v] || {}\n      Object.keys(cur[v]).forEach((t) => {\n        acc[v][t] = cur[v][t]\n      })\n    })\n  }\n\n  return acc\n}\n\n// return whatever was printed\nfunction showFields (data, version, fields) {\n  const o = {}\n  ;[data, version].forEach((s) => {\n    Object.keys(s).forEach((k) => {\n      o[k] = s[k]\n    })\n  })\n\n  const queryable = new Queryable(o)\n  const s = queryable.query(fields)\n  const res = { [version.version]: s }\n\n  if (s)\n    return res\n}\n\nfunction cleanup (data) {\n  if (Array.isArray(data))\n    return data.map(cleanup)\n\n  if (!data || typeof data !== 'object')\n    return data\n\n  const keys = Object.keys(data)\n  if (keys.length <= 3 &&\n      data.name &&\n      (keys.length === 1 ||\n       (keys.length === 3 && data.email && data.url) ||\n       (keys.length === 2 && (data.email || data.url))))\n    data = unparsePerson(data)\n\n  return data\n}\n\nfunction unparsePerson (d) {\n  return d.name +\n    (d.email ? ' <' + d.email + '>' : '') +\n    (d.url ? ' (' + d.url + ')' : '')\n}\n"]},"metadata":{},"sourceType":"script"}