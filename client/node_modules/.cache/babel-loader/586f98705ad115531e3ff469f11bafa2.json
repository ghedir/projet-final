{"ast":null,"code":"const hookApi = require('libnpmhook');\n\nconst otplease = require('./utils/otplease.js');\n\nconst relativeDate = require('tiny-relative-date');\n\nconst Table = require('cli-table3');\n\nconst BaseCommand = require('./base-command.js');\n\nclass Hook extends BaseCommand {\n  static get description() {\n    return 'Manage registry hooks';\n  }\n\n  static get name() {\n    return 'hook';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get params() {\n    return ['registry', 'otp'];\n  }\n\n  static get usage() {\n    return ['add <pkg> <url> <secret> [--type=<type>]', 'ls [pkg]', 'rm <id>', 'update <id> <url> <secret>'];\n  }\n\n  exec(args, cb) {\n    this.hook(args).then(() => cb()).catch(cb);\n  }\n\n  async hook(args) {\n    return otplease(this.npm.flatOptions, opts => {\n      switch (args[0]) {\n        case 'add':\n          return this.add(args[1], args[2], args[3], opts);\n\n        case 'ls':\n          return this.ls(args[1], opts);\n\n        case 'rm':\n          return this.rm(args[1], opts);\n\n        case 'update':\n        case 'up':\n          return this.update(args[1], args[2], args[3], opts);\n\n        default:\n          throw this.usage;\n      }\n    });\n  }\n\n  async add(pkg, uri, secret, opts) {\n    const hook = await hookApi.add(pkg, uri, secret, opts);\n    if (opts.json) this.npm.output(JSON.stringify(hook, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'));\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${opts.unicode ? ' ➜ ' : ' -> '} ${hook.endpoint}`);\n    }\n  }\n\n  async ls(pkg, opts) {\n    const hooks = await hookApi.ls({ ...opts,\n      package: pkg\n    });\n    if (opts.json) this.npm.output(JSON.stringify(hooks, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hooks[0]).join('\\t'));\n      hooks.forEach(hook => {\n        this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n      });\n    } else if (!hooks.length) this.npm.output(\"You don't have any hooks configured yet.\");else if (!opts.silent && opts.loglevel !== 'silent') {\n      if (hooks.length === 1) this.npm.output('You have one hook configured.');else this.npm.output(`You have ${hooks.length} hooks configured.`);\n      const table = new Table({\n        head: ['id', 'target', 'endpoint']\n      });\n      hooks.forEach(hook => {\n        table.push([{\n          rowSpan: 2,\n          content: hook.id\n        }, this.hookName(hook), hook.endpoint]);\n\n        if (hook.last_delivery) {\n          table.push([{\n            colSpan: 1,\n            content: `triggered ${relativeDate(hook.last_delivery)}`\n          }, hook.response_code]);\n        } else table.push([{\n          colSpan: 2,\n          content: 'never triggered'\n        }]);\n      });\n      this.npm.output(table.toString());\n    }\n  }\n\n  async rm(id, opts) {\n    const hook = await hookApi.rm(id, opts);\n    if (opts.json) this.npm.output(JSON.stringify(hook, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'));\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`- ${this.hookName(hook)} ${opts.unicode ? ' ✘ ' : ' X '} ${hook.endpoint}`);\n    }\n  }\n\n  async update(id, uri, secret, opts) {\n    const hook = await hookApi.update(id, uri, secret, opts);\n    if (opts.json) this.npm.output(JSON.stringify(hook, null, 2));else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'));\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'));\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${opts.unicode ? ' ➜ ' : ' -> '} ${hook.endpoint}`);\n    }\n  }\n\n  hookName(hook) {\n    let target = hook.name;\n    if (hook.type === 'scope') target = '@' + target;\n    if (hook.type === 'owner') target = '~' + target;\n    return target;\n  }\n\n}\n\nmodule.exports = Hook;","map":{"version":3,"sources":["C:/Users/ghedi/Documents/GhedBlog/node_modules/npm/lib/hook.js"],"names":["hookApi","require","otplease","relativeDate","Table","BaseCommand","Hook","description","name","params","usage","exec","args","cb","hook","then","catch","npm","flatOptions","opts","add","ls","rm","update","pkg","uri","secret","json","output","JSON","stringify","parseable","Object","keys","join","map","k","silent","loglevel","hookName","unicode","endpoint","hooks","package","forEach","length","table","head","push","rowSpan","content","id","last_delivery","colSpan","response_code","toString","target","type","module","exports"],"mappings":"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","sourcesContent":["const hookApi = require('libnpmhook')\nconst otplease = require('./utils/otplease.js')\nconst relativeDate = require('tiny-relative-date')\nconst Table = require('cli-table3')\n\nconst BaseCommand = require('./base-command.js')\nclass Hook extends BaseCommand {\n  static get description () {\n    return 'Manage registry hooks'\n  }\n\n  static get name () {\n    return 'hook'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params () {\n    return [\n      'registry',\n      'otp',\n    ]\n  }\n\n  static get usage () {\n    return [\n      'add <pkg> <url> <secret> [--type=<type>]',\n      'ls [pkg]',\n      'rm <id>',\n      'update <id> <url> <secret>',\n    ]\n  }\n\n  exec (args, cb) {\n    this.hook(args).then(() => cb()).catch(cb)\n  }\n\n  async hook (args) {\n    return otplease(this.npm.flatOptions, (opts) => {\n      switch (args[0]) {\n        case 'add':\n          return this.add(args[1], args[2], args[3], opts)\n        case 'ls':\n          return this.ls(args[1], opts)\n        case 'rm':\n          return this.rm(args[1], opts)\n        case 'update':\n        case 'up':\n          return this.update(args[1], args[2], args[3], opts)\n        default:\n          throw this.usage\n      }\n    })\n  }\n\n  async add (pkg, uri, secret, opts) {\n    const hook = await hookApi.add(pkg, uri, secret, opts)\n    if (opts.json)\n      this.npm.output(JSON.stringify(hook, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'))\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${\n        opts.unicode ? ' ➜ ' : ' -> '\n      } ${hook.endpoint}`)\n    }\n  }\n\n  async ls (pkg, opts) {\n    const hooks = await hookApi.ls({ ...opts, package: pkg })\n    if (opts.json)\n      this.npm.output(JSON.stringify(hooks, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hooks[0]).join('\\t'))\n      hooks.forEach(hook => {\n        this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n      })\n    } else if (!hooks.length)\n      this.npm.output(\"You don't have any hooks configured yet.\")\n    else if (!opts.silent && opts.loglevel !== 'silent') {\n      if (hooks.length === 1)\n        this.npm.output('You have one hook configured.')\n      else\n        this.npm.output(`You have ${hooks.length} hooks configured.`)\n\n      const table = new Table({ head: ['id', 'target', 'endpoint'] })\n      hooks.forEach((hook) => {\n        table.push([\n          { rowSpan: 2, content: hook.id },\n          this.hookName(hook),\n          hook.endpoint,\n        ])\n        if (hook.last_delivery) {\n          table.push([\n            {\n              colSpan: 1,\n              content: `triggered ${relativeDate(hook.last_delivery)}`,\n            },\n            hook.response_code,\n          ])\n        } else\n          table.push([{ colSpan: 2, content: 'never triggered' }])\n      })\n      this.npm.output(table.toString())\n    }\n  }\n\n  async rm (id, opts) {\n    const hook = await hookApi.rm(id, opts)\n    if (opts.json)\n      this.npm.output(JSON.stringify(hook, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'))\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`- ${this.hookName(hook)} ${\n        opts.unicode ? ' ✘ ' : ' X '\n      } ${hook.endpoint}`)\n    }\n  }\n\n  async update (id, uri, secret, opts) {\n    const hook = await hookApi.update(id, uri, secret, opts)\n    if (opts.json)\n      this.npm.output(JSON.stringify(hook, null, 2))\n    else if (opts.parseable) {\n      this.npm.output(Object.keys(hook).join('\\t'))\n      this.npm.output(Object.keys(hook).map(k => hook[k]).join('\\t'))\n    } else if (!opts.silent && opts.loglevel !== 'silent') {\n      this.npm.output(`+ ${this.hookName(hook)} ${\n        opts.unicode ? ' ➜ ' : ' -> '\n      } ${hook.endpoint}`)\n    }\n  }\n\n  hookName (hook) {\n    let target = hook.name\n    if (hook.type === 'scope')\n      target = '@' + target\n    if (hook.type === 'owner')\n      target = '~' + target\n    return target\n  }\n}\nmodule.exports = Hook\n"]},"metadata":{},"sourceType":"script"}