{"ast":null,"code":"var fs = require('fs');\n\nvar path = require('path');\n\nvar glob = require('glob');\n\nvar normalizeData = require('normalize-package-data');\n\nvar safeJSON = require('json-parse-even-better-errors');\n\nvar util = require('util');\n\nvar normalizePackageBin = require('npm-normalize-package-bin');\n\nmodule.exports = readJson; // put more stuff on here to customize.\n\nreadJson.extraSet = [bundleDependencies, gypfile, serverjs, scriptpath, authors, readme, mans, bins, githead, fillTypes];\nvar typoWarned = {};\nvar cache = {};\n\nfunction readJson(file, log_, strict_, cb_) {\n  var log, strict, cb;\n\n  for (var i = 1; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i];\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i];\n    }\n  }\n\n  if (!log) {\n    log = function () {};\n  }\n\n  cb = arguments[arguments.length - 1];\n  readJson_(file, log, strict, cb);\n}\n\nfunction readJson_(file, log, strict, cb) {\n  fs.readFile(file, 'utf8', function (er, d) {\n    parseJson(file, er, d, log, strict, cb);\n  });\n}\n\nfunction stripBOM(content) {\n  // Remove byte order marker. This catches EF BB BF (the UTF-8 BOM)\n  // because the buffer-to-string conversion in `fs.readFileSync()`\n  // translates it to FEFF, the UTF-16 BOM.\n  if (content.charCodeAt(0) === 0xFEFF) {\n    content = content.slice(1);\n  }\n\n  return content;\n}\n\nfunction jsonClone(obj) {\n  if (obj == null) {\n    return obj;\n  } else if (Array.isArray(obj)) {\n    var newarr = new Array(obj.length);\n\n    for (var ii in obj) {\n      newarr[ii] = obj[ii];\n    }\n  } else if (typeof obj === 'object') {\n    var newobj = {};\n\n    for (var kk in obj) {\n      newobj[kk] = jsonClone[kk];\n    }\n  } else {\n    return obj;\n  }\n}\n\nfunction parseJson(file, er, d, log, strict, cb) {\n  if (er && er.code === 'ENOENT') {\n    return fs.stat(path.dirname(file), function (err, stat) {\n      if (!err && stat && !stat.isDirectory()) {\n        // ENOTDIR isn't used on Windows, but npm expects it.\n        er = Object.create(er);\n        er.code = 'ENOTDIR';\n        return cb(er);\n      } else {\n        return indexjs(file, er, log, strict, cb);\n      }\n    });\n  }\n\n  if (er) {\n    return cb(er);\n  }\n\n  if (cache[d]) {\n    return cb(null, jsonClone(cache[d]));\n  }\n\n  var data;\n\n  try {\n    data = safeJSON(stripBOM(d));\n\n    for (var key in data) {\n      if (/^_/.test(key)) {\n        delete data[key];\n      }\n    }\n  } catch (er) {\n    data = parseIndex(d);\n\n    if (!data) {\n      return cb(parseError(er, file));\n    }\n  }\n\n  extrasCached(file, d, data, log, strict, cb);\n}\n\nfunction extrasCached(file, d, data, log, strict, cb) {\n  extras(file, data, log, strict, function (err, data) {\n    if (!err) {\n      cache[d] = jsonClone(data);\n    }\n\n    cb(err, data);\n  });\n}\n\nfunction indexjs(file, er, log, strict, cb) {\n  if (path.basename(file) === 'index.js') {\n    return cb(er);\n  }\n\n  var index = path.resolve(path.dirname(file), 'index.js');\n  fs.readFile(index, 'utf8', function (er2, d) {\n    if (er2) {\n      return cb(er);\n    }\n\n    if (cache[d]) {\n      return cb(null, cache[d]);\n    }\n\n    var data = parseIndex(d);\n\n    if (!data) {\n      return cb(er);\n    }\n\n    extrasCached(file, d, data, log, strict, cb);\n  });\n}\n\nreadJson.extras = extras;\n\nfunction extras(file, data, log_, strict_, cb_) {\n  var log, strict, cb;\n\n  for (var i = 2; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i];\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i];\n    }\n  }\n\n  if (!log) {\n    log = function () {};\n  }\n\n  cb = arguments[i];\n  var set = readJson.extraSet;\n  var n = set.length;\n  var errState = null;\n  set.forEach(function (fn) {\n    fn(file, data, then);\n  });\n\n  function then(er) {\n    if (errState) {\n      return;\n    }\n\n    if (er) {\n      return cb(errState = er);\n    }\n\n    if (--n > 0) {\n      return;\n    }\n\n    final(file, data, log, strict, cb);\n  }\n}\n\nfunction scriptpath(file, data, cb) {\n  if (!data.scripts) {\n    return cb(null, data);\n  }\n\n  var k = Object.keys(data.scripts);\n  k.forEach(scriptpath_, data.scripts);\n  cb(null, data);\n}\n\nfunction scriptpath_(key) {\n  var s = this[key]; // This is never allowed, and only causes problems\n\n  if (typeof s !== 'string') {\n    return delete this[key];\n  }\n\n  var spre = /^(\\.[/\\\\])?node_modules[/\\\\].bin[\\\\/]/;\n\n  if (s.match(spre)) {\n    this[key] = this[key].replace(spre, '');\n  }\n}\n\nfunction gypfile(file, data, cb) {\n  var dir = path.dirname(file);\n  var s = data.scripts || {};\n\n  if (s.install || s.preinstall) {\n    return cb(null, data);\n  }\n\n  glob('*.gyp', {\n    cwd: dir\n  }, function (er, files) {\n    if (er) {\n      return cb(er);\n    }\n\n    if (data.gypfile === false) {\n      return cb(null, data);\n    }\n\n    gypfile_(file, data, files, cb);\n  });\n}\n\nfunction gypfile_(file, data, files, cb) {\n  if (!files.length) {\n    return cb(null, data);\n  }\n\n  var s = data.scripts || {};\n  s.install = 'node-gyp rebuild';\n  data.scripts = s;\n  data.gypfile = true;\n  return cb(null, data);\n}\n\nfunction serverjs(file, data, cb) {\n  var dir = path.dirname(file);\n  var s = data.scripts || {};\n\n  if (s.start) {\n    return cb(null, data);\n  }\n\n  glob('server.js', {\n    cwd: dir\n  }, function (er, files) {\n    if (er) {\n      return cb(er);\n    }\n\n    serverjs_(file, data, files, cb);\n  });\n}\n\nfunction serverjs_(file, data, files, cb) {\n  if (!files.length) {\n    return cb(null, data);\n  }\n\n  var s = data.scripts || {};\n  s.start = 'node server.js';\n  data.scripts = s;\n  return cb(null, data);\n}\n\nfunction authors(file, data, cb) {\n  if (data.contributors) {\n    return cb(null, data);\n  }\n\n  var af = path.resolve(path.dirname(file), 'AUTHORS');\n  fs.readFile(af, 'utf8', function (er, ad) {\n    // ignore error.  just checking it.\n    if (er) {\n      return cb(null, data);\n    }\n\n    authors_(file, data, ad, cb);\n  });\n}\n\nfunction authors_(file, data, ad, cb) {\n  ad = ad.split(/\\r?\\n/g).map(function (line) {\n    return line.replace(/^\\s*#.*$/, '').trim();\n  }).filter(function (line) {\n    return line;\n  });\n  data.contributors = ad;\n  return cb(null, data);\n}\n\nfunction readme(file, data, cb) {\n  if (data.readme) {\n    return cb(null, data);\n  }\n\n  var dir = path.dirname(file);\n  var globOpts = {\n    cwd: dir,\n    nocase: true,\n    mark: true\n  };\n  glob('{README,README.*}', globOpts, function (er, files) {\n    if (er) {\n      return cb(er);\n    } // don't accept directories.\n\n\n    files = files.filter(function (file) {\n      return !file.match(/\\/$/);\n    });\n\n    if (!files.length) {\n      return cb();\n    }\n\n    var fn = preferMarkdownReadme(files);\n    var rm = path.resolve(dir, fn);\n    readme_(file, data, rm, cb);\n  });\n}\n\nfunction preferMarkdownReadme(files) {\n  var fallback = 0;\n  var re = /\\.m?a?r?k?d?o?w?n?$/i;\n\n  for (var i = 0; i < files.length; i++) {\n    if (files[i].match(re)) {\n      return files[i];\n    } else if (files[i].match(/README$/)) {\n      fallback = i;\n    }\n  } // prefer README.md, followed by README; otherwise, return\n  // the first filename (which could be README)\n\n\n  return files[fallback];\n}\n\nfunction readme_(file, data, rm, cb) {\n  var rmfn = path.basename(rm);\n  fs.readFile(rm, 'utf8', function (er, rm) {\n    // maybe not readable, or something.\n    if (er) {\n      return cb();\n    }\n\n    data.readme = rm;\n    data.readmeFilename = rmfn;\n    return cb(er, data);\n  });\n}\n\nfunction mans(file, data, cb) {\n  let cwd = data.directories && data.directories.man;\n\n  if (data.man || !cwd) {\n    return cb(null, data);\n  }\n\n  const dirname = path.dirname(file);\n  cwd = path.resolve(path.dirname(file), cwd);\n  glob('**/*.[0-9]', {\n    cwd\n  }, function (er, mans) {\n    if (er) {\n      return cb(er);\n    }\n\n    data.man = mans.map(man => path.relative(dirname, path.join(cwd, man)));\n    return cb(null, data);\n  });\n}\n\nfunction bins(file, data, cb) {\n  data = normalizePackageBin(data);\n  var m = data.directories && data.directories.bin;\n\n  if (data.bin || !m) {\n    return cb(null, data);\n  }\n\n  m = path.resolve(path.dirname(file), m);\n  glob('**', {\n    cwd: m\n  }, function (er, bins) {\n    if (er) {\n      return cb(er);\n    }\n\n    bins_(file, data, bins, cb);\n  });\n}\n\nfunction bins_(file, data, bins, cb) {\n  var m = data.directories && data.directories.bin || '.';\n  data.bin = bins.reduce(function (acc, mf) {\n    if (mf && mf.charAt(0) !== '.') {\n      var f = path.basename(mf);\n      acc[f] = path.join(m, mf);\n    }\n\n    return acc;\n  }, {});\n  return cb(null, normalizePackageBin(data));\n}\n\nfunction bundleDependencies(file, data, cb) {\n  var bd = 'bundleDependencies';\n  var bdd = 'bundledDependencies'; // normalize key name\n\n  if (data[bdd] !== undefined) {\n    if (data[bd] === undefined) {\n      data[bd] = data[bdd];\n    }\n\n    delete data[bdd];\n  }\n\n  if (data[bd] === false) {\n    delete data[bd];\n  } else if (data[bd] === true) {\n    data[bd] = Object.keys(data.dependencies || {});\n  } else if (data[bd] !== undefined && !Array.isArray(data[bd])) {\n    delete data[bd];\n  }\n\n  return cb(null, data);\n}\n\nfunction githead(file, data, cb) {\n  if (data.gitHead) {\n    return cb(null, data);\n  }\n\n  var dir = path.dirname(file);\n  var head = path.resolve(dir, '.git/HEAD');\n  fs.readFile(head, 'utf8', function (er, head) {\n    if (er) {\n      var parent = path.dirname(dir);\n\n      if (parent === dir) {\n        return cb(null, data);\n      }\n\n      return githead(dir, data, cb);\n    }\n\n    githead_(data, dir, head, cb);\n  });\n}\n\nfunction githead_(data, dir, head, cb) {\n  if (!head.match(/^ref: /)) {\n    data.gitHead = head.trim();\n    return cb(null, data);\n  }\n\n  var headRef = head.replace(/^ref: /, '').trim();\n  var headFile = path.resolve(dir, '.git', headRef);\n  fs.readFile(headFile, 'utf8', function (er, head) {\n    if (er || !head) {\n      var packFile = path.resolve(dir, '.git/packed-refs');\n      return fs.readFile(packFile, 'utf8', function (er, refs) {\n        if (er || !refs) {\n          return cb(null, data);\n        }\n\n        refs = refs.split('\\n');\n\n        for (var i = 0; i < refs.length; i++) {\n          var match = refs[i].match(/^([0-9a-f]{40}) (.+)$/);\n\n          if (match && match[2].trim() === headRef) {\n            data.gitHead = match[1];\n            break;\n          }\n        }\n\n        return cb(null, data);\n      });\n    }\n\n    head = head.replace(/^ref: /, '').trim();\n    data.gitHead = head;\n    return cb(null, data);\n  });\n}\n/**\n * Warn if the bin references don't point to anything.  This might be better in\n * normalize-package-data if it had access to the file path.\n */\n\n\nfunction checkBinReferences_(file, data, warn, cb) {\n  if (!(data.bin instanceof Object)) {\n    return cb();\n  }\n\n  var keys = Object.keys(data.bin);\n  var keysLeft = keys.length;\n\n  if (!keysLeft) {\n    return cb();\n  }\n\n  function handleExists(relName, result) {\n    keysLeft--;\n\n    if (!result) {\n      warn('No bin file found at ' + relName);\n    }\n\n    if (!keysLeft) {\n      cb();\n    }\n  }\n\n  keys.forEach(function (key) {\n    var dirName = path.dirname(file);\n    var relName = data.bin[key];\n    /* istanbul ignore if - impossible, bins have been normalized */\n\n    if (typeof relName !== 'string') {\n      var msg = 'Bin filename for ' + key + ' is not a string: ' + util.inspect(relName);\n      warn(msg);\n      delete data.bin[key];\n      handleExists(relName, true);\n      return;\n    }\n\n    var binPath = path.resolve(dirName, relName);\n    fs.stat(binPath, err => handleExists(relName, !err));\n  });\n}\n\nfunction final(file, data, log, strict, cb) {\n  var pId = makePackageId(data);\n\n  function warn(msg) {\n    if (typoWarned[pId]) {\n      return;\n    }\n\n    if (log) {\n      log('package.json', pId, msg);\n    }\n  }\n\n  try {\n    normalizeData(data, warn, strict);\n  } catch (error) {\n    return cb(error);\n  }\n\n  checkBinReferences_(file, data, warn, function () {\n    typoWarned[pId] = true;\n    cb(null, data);\n  });\n}\n\nfunction fillTypes(file, data, cb) {\n  var index = data.main ? data.main : 'index.js'; // TODO exports is much more complicated than this in verbose format\n  // We need to support for instance\n  // \"exports\": {\n  //   \".\": [\n  //     {\n  //       \"default\": \"./lib/npm.js\"\n  //     },\n  //     \"./lib/npm.js\"\n  //   ],\n  //   \"./package.json\": \"./package.json\"\n  // },\n  // as well as conditional exports\n  // if (data.exports && typeof data.exports === 'string') {\n  //   index = data.exports\n  // }\n  // if (data.exports && data.exports['.']) {\n  //   index = data.exports['.']\n  //   if (typeof index !== 'string') {\n  //   }\n  // }\n\n  var extless = path.join(path.dirname(index), path.basename(index, path.extname(index)));\n  var dts = `./${extless}.d.ts`;\n  var dtsPath = path.join(path.dirname(file), dts);\n  var hasDTSFields = 'types' in data || 'typings' in data;\n\n  if (!hasDTSFields && fs.existsSync(dtsPath)) {\n    data.types = dts;\n  }\n\n  cb(null, data);\n}\n\nfunction makePackageId(data) {\n  var name = cleanString(data.name);\n  var ver = cleanString(data.version);\n  return name + '@' + ver;\n}\n\nfunction cleanString(str) {\n  return !str || typeof str !== 'string' ? '' : str.trim();\n} // /**package { \"name\": \"foo\", \"version\": \"1.2.3\", ... } **/\n\n\nfunction parseIndex(data) {\n  data = data.split(/^\\/\\*\\*package(?:\\s|$)/m);\n\n  if (data.length < 2) {\n    return null;\n  }\n\n  data = data[1];\n  data = data.split(/\\*\\*\\/$/m);\n\n  if (data.length < 2) {\n    return null;\n  }\n\n  data = data[0];\n  data = data.replace(/^\\s*\\*/mg, '');\n\n  try {\n    return safeJSON(data);\n  } catch (er) {\n    return null;\n  }\n}\n\nfunction parseError(ex, file) {\n  var e = new Error('Failed to parse json\\n' + ex.message);\n  e.code = 'EJSONPARSE';\n  e.path = file;\n  return e;\n}","map":{"version":3,"sources":["C:/Users/ghedi/Documents/GhedBlog/node_modules/npm/node_modules/read-package-json/read-json.js"],"names":["fs","require","path","glob","normalizeData","safeJSON","util","normalizePackageBin","module","exports","readJson","extraSet","bundleDependencies","gypfile","serverjs","scriptpath","authors","readme","mans","bins","githead","fillTypes","typoWarned","cache","file","log_","strict_","cb_","log","strict","cb","i","arguments","length","readJson_","readFile","er","d","parseJson","stripBOM","content","charCodeAt","slice","jsonClone","obj","Array","isArray","newarr","ii","newobj","kk","code","stat","dirname","err","isDirectory","Object","create","indexjs","data","key","test","parseIndex","parseError","extrasCached","extras","basename","index","resolve","er2","set","n","errState","forEach","fn","then","final","scripts","k","keys","scriptpath_","s","spre","match","replace","dir","install","preinstall","cwd","files","gypfile_","start","serverjs_","contributors","af","ad","authors_","split","map","line","trim","filter","globOpts","nocase","mark","preferMarkdownReadme","rm","readme_","fallback","re","rmfn","readmeFilename","directories","man","relative","join","m","bin","bins_","reduce","acc","mf","charAt","f","bd","bdd","undefined","dependencies","gitHead","head","parent","githead_","headRef","headFile","packFile","refs","checkBinReferences_","warn","keysLeft","handleExists","relName","result","dirName","msg","inspect","binPath","pId","makePackageId","error","main","extless","extname","dts","dtsPath","hasDTSFields","existsSync","types","name","cleanString","ver","version","str","ex","e","Error","message"],"mappings":"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","sourcesContent":["var fs = require('fs')\n\nvar path = require('path')\n\nvar glob = require('glob')\nvar normalizeData = require('normalize-package-data')\nvar safeJSON = require('json-parse-even-better-errors')\nvar util = require('util')\nvar normalizePackageBin = require('npm-normalize-package-bin')\n\nmodule.exports = readJson\n\n// put more stuff on here to customize.\nreadJson.extraSet = [\n  bundleDependencies,\n  gypfile,\n  serverjs,\n  scriptpath,\n  authors,\n  readme,\n  mans,\n  bins,\n  githead,\n  fillTypes,\n]\n\nvar typoWarned = {}\nvar cache = {}\n\nfunction readJson (file, log_, strict_, cb_) {\n  var log, strict, cb\n  for (var i = 1; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i]\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i]\n    }\n  }\n\n  if (!log) {\n    log = function () {}\n  }\n  cb = arguments[arguments.length - 1]\n\n  readJson_(file, log, strict, cb)\n}\n\nfunction readJson_ (file, log, strict, cb) {\n  fs.readFile(file, 'utf8', function (er, d) {\n    parseJson(file, er, d, log, strict, cb)\n  })\n}\n\nfunction stripBOM (content) {\n  // Remove byte order marker. This catches EF BB BF (the UTF-8 BOM)\n  // because the buffer-to-string conversion in `fs.readFileSync()`\n  // translates it to FEFF, the UTF-16 BOM.\n  if (content.charCodeAt(0) === 0xFEFF) {\n    content = content.slice(1)\n  }\n  return content\n}\n\nfunction jsonClone (obj) {\n  if (obj == null) {\n    return obj\n  } else if (Array.isArray(obj)) {\n    var newarr = new Array(obj.length)\n    for (var ii in obj) {\n      newarr[ii] = obj[ii]\n    }\n  } else if (typeof obj === 'object') {\n    var newobj = {}\n    for (var kk in obj) {\n      newobj[kk] = jsonClone[kk]\n    }\n  } else {\n    return obj\n  }\n}\n\nfunction parseJson (file, er, d, log, strict, cb) {\n  if (er && er.code === 'ENOENT') {\n    return fs.stat(path.dirname(file), function (err, stat) {\n      if (!err && stat && !stat.isDirectory()) {\n        // ENOTDIR isn't used on Windows, but npm expects it.\n        er = Object.create(er)\n        er.code = 'ENOTDIR'\n        return cb(er)\n      } else {\n        return indexjs(file, er, log, strict, cb)\n      }\n    })\n  }\n  if (er) {\n    return cb(er)\n  }\n\n  if (cache[d]) {\n    return cb(null, jsonClone(cache[d]))\n  }\n\n  var data\n\n  try {\n    data = safeJSON(stripBOM(d))\n    for (var key in data) {\n      if (/^_/.test(key)) {\n        delete data[key]\n      }\n    }\n  } catch (er) {\n    data = parseIndex(d)\n    if (!data) {\n      return cb(parseError(er, file))\n    }\n  }\n\n  extrasCached(file, d, data, log, strict, cb)\n}\n\nfunction extrasCached (file, d, data, log, strict, cb) {\n  extras(file, data, log, strict, function (err, data) {\n    if (!err) {\n      cache[d] = jsonClone(data)\n    }\n    cb(err, data)\n  })\n}\n\nfunction indexjs (file, er, log, strict, cb) {\n  if (path.basename(file) === 'index.js') {\n    return cb(er)\n  }\n\n  var index = path.resolve(path.dirname(file), 'index.js')\n  fs.readFile(index, 'utf8', function (er2, d) {\n    if (er2) {\n      return cb(er)\n    }\n\n    if (cache[d]) {\n      return cb(null, cache[d])\n    }\n\n    var data = parseIndex(d)\n    if (!data) {\n      return cb(er)\n    }\n\n    extrasCached(file, d, data, log, strict, cb)\n  })\n}\n\nreadJson.extras = extras\nfunction extras (file, data, log_, strict_, cb_) {\n  var log, strict, cb\n  for (var i = 2; i < arguments.length - 1; i++) {\n    if (typeof arguments[i] === 'boolean') {\n      strict = arguments[i]\n    } else if (typeof arguments[i] === 'function') {\n      log = arguments[i]\n    }\n  }\n\n  if (!log) {\n    log = function () {}\n  }\n  cb = arguments[i]\n\n  var set = readJson.extraSet\n  var n = set.length\n  var errState = null\n  set.forEach(function (fn) {\n    fn(file, data, then)\n  })\n\n  function then (er) {\n    if (errState) {\n      return\n    }\n    if (er) {\n      return cb(errState = er)\n    }\n    if (--n > 0) {\n      return\n    }\n    final(file, data, log, strict, cb)\n  }\n}\n\nfunction scriptpath (file, data, cb) {\n  if (!data.scripts) {\n    return cb(null, data)\n  }\n  var k = Object.keys(data.scripts)\n  k.forEach(scriptpath_, data.scripts)\n  cb(null, data)\n}\n\nfunction scriptpath_ (key) {\n  var s = this[key]\n  // This is never allowed, and only causes problems\n  if (typeof s !== 'string') {\n    return delete this[key]\n  }\n\n  var spre = /^(\\.[/\\\\])?node_modules[/\\\\].bin[\\\\/]/\n  if (s.match(spre)) {\n    this[key] = this[key].replace(spre, '')\n  }\n}\n\nfunction gypfile (file, data, cb) {\n  var dir = path.dirname(file)\n  var s = data.scripts || {}\n  if (s.install || s.preinstall) {\n    return cb(null, data)\n  }\n\n  glob('*.gyp', { cwd: dir }, function (er, files) {\n    if (er) {\n      return cb(er)\n    }\n    if (data.gypfile === false) {\n      return cb(null, data)\n    }\n    gypfile_(file, data, files, cb)\n  })\n}\n\nfunction gypfile_ (file, data, files, cb) {\n  if (!files.length) {\n    return cb(null, data)\n  }\n  var s = data.scripts || {}\n  s.install = 'node-gyp rebuild'\n  data.scripts = s\n  data.gypfile = true\n  return cb(null, data)\n}\n\nfunction serverjs (file, data, cb) {\n  var dir = path.dirname(file)\n  var s = data.scripts || {}\n  if (s.start) {\n    return cb(null, data)\n  }\n  glob('server.js', { cwd: dir }, function (er, files) {\n    if (er) {\n      return cb(er)\n    }\n    serverjs_(file, data, files, cb)\n  })\n}\n\nfunction serverjs_ (file, data, files, cb) {\n  if (!files.length) {\n    return cb(null, data)\n  }\n  var s = data.scripts || {}\n  s.start = 'node server.js'\n  data.scripts = s\n  return cb(null, data)\n}\n\nfunction authors (file, data, cb) {\n  if (data.contributors) {\n    return cb(null, data)\n  }\n  var af = path.resolve(path.dirname(file), 'AUTHORS')\n  fs.readFile(af, 'utf8', function (er, ad) {\n    // ignore error.  just checking it.\n    if (er) {\n      return cb(null, data)\n    }\n    authors_(file, data, ad, cb)\n  })\n}\n\nfunction authors_ (file, data, ad, cb) {\n  ad = ad.split(/\\r?\\n/g).map(function (line) {\n    return line.replace(/^\\s*#.*$/, '').trim()\n  }).filter(function (line) {\n    return line\n  })\n  data.contributors = ad\n  return cb(null, data)\n}\n\nfunction readme (file, data, cb) {\n  if (data.readme) {\n    return cb(null, data)\n  }\n  var dir = path.dirname(file)\n  var globOpts = { cwd: dir, nocase: true, mark: true }\n  glob('{README,README.*}', globOpts, function (er, files) {\n    if (er) {\n      return cb(er)\n    }\n    // don't accept directories.\n    files = files.filter(function (file) {\n      return !file.match(/\\/$/)\n    })\n    if (!files.length) {\n      return cb()\n    }\n    var fn = preferMarkdownReadme(files)\n    var rm = path.resolve(dir, fn)\n    readme_(file, data, rm, cb)\n  })\n}\n\nfunction preferMarkdownReadme (files) {\n  var fallback = 0\n  var re = /\\.m?a?r?k?d?o?w?n?$/i\n  for (var i = 0; i < files.length; i++) {\n    if (files[i].match(re)) {\n      return files[i]\n    } else if (files[i].match(/README$/)) {\n      fallback = i\n    }\n  }\n  // prefer README.md, followed by README; otherwise, return\n  // the first filename (which could be README)\n  return files[fallback]\n}\n\nfunction readme_ (file, data, rm, cb) {\n  var rmfn = path.basename(rm)\n  fs.readFile(rm, 'utf8', function (er, rm) {\n    // maybe not readable, or something.\n    if (er) {\n      return cb()\n    }\n    data.readme = rm\n    data.readmeFilename = rmfn\n    return cb(er, data)\n  })\n}\n\nfunction mans (file, data, cb) {\n  let cwd = data.directories && data.directories.man\n  if (data.man || !cwd) {\n    return cb(null, data)\n  }\n  const dirname = path.dirname(file)\n  cwd = path.resolve(path.dirname(file), cwd)\n  glob('**/*.[0-9]', { cwd }, function (er, mans) {\n    if (er) {\n      return cb(er)\n    }\n    data.man = mans.map(man => path.relative(dirname, path.join(cwd, man)))\n    return cb(null, data)\n  })\n}\n\nfunction bins (file, data, cb) {\n  data = normalizePackageBin(data)\n\n  var m = data.directories && data.directories.bin\n  if (data.bin || !m) {\n    return cb(null, data)\n  }\n\n  m = path.resolve(path.dirname(file), m)\n  glob('**', { cwd: m }, function (er, bins) {\n    if (er) {\n      return cb(er)\n    }\n    bins_(file, data, bins, cb)\n  })\n}\n\nfunction bins_ (file, data, bins, cb) {\n  var m = (data.directories && data.directories.bin) || '.'\n  data.bin = bins.reduce(function (acc, mf) {\n    if (mf && mf.charAt(0) !== '.') {\n      var f = path.basename(mf)\n      acc[f] = path.join(m, mf)\n    }\n    return acc\n  }, {})\n  return cb(null, normalizePackageBin(data))\n}\n\nfunction bundleDependencies (file, data, cb) {\n  var bd = 'bundleDependencies'\n  var bdd = 'bundledDependencies'\n  // normalize key name\n  if (data[bdd] !== undefined) {\n    if (data[bd] === undefined) {\n      data[bd] = data[bdd]\n    }\n    delete data[bdd]\n  }\n  if (data[bd] === false) {\n    delete data[bd]\n  } else if (data[bd] === true) {\n    data[bd] = Object.keys(data.dependencies || {})\n  } else if (data[bd] !== undefined && !Array.isArray(data[bd])) {\n    delete data[bd]\n  }\n  return cb(null, data)\n}\n\nfunction githead (file, data, cb) {\n  if (data.gitHead) {\n    return cb(null, data)\n  }\n  var dir = path.dirname(file)\n  var head = path.resolve(dir, '.git/HEAD')\n  fs.readFile(head, 'utf8', function (er, head) {\n    if (er) {\n      var parent = path.dirname(dir)\n      if (parent === dir) {\n        return cb(null, data)\n      }\n      return githead(dir, data, cb)\n    }\n    githead_(data, dir, head, cb)\n  })\n}\n\nfunction githead_ (data, dir, head, cb) {\n  if (!head.match(/^ref: /)) {\n    data.gitHead = head.trim()\n    return cb(null, data)\n  }\n  var headRef = head.replace(/^ref: /, '').trim()\n  var headFile = path.resolve(dir, '.git', headRef)\n  fs.readFile(headFile, 'utf8', function (er, head) {\n    if (er || !head) {\n      var packFile = path.resolve(dir, '.git/packed-refs')\n      return fs.readFile(packFile, 'utf8', function (er, refs) {\n        if (er || !refs) {\n          return cb(null, data)\n        }\n        refs = refs.split('\\n')\n        for (var i = 0; i < refs.length; i++) {\n          var match = refs[i].match(/^([0-9a-f]{40}) (.+)$/)\n          if (match && match[2].trim() === headRef) {\n            data.gitHead = match[1]\n            break\n          }\n        }\n        return cb(null, data)\n      })\n    }\n    head = head.replace(/^ref: /, '').trim()\n    data.gitHead = head\n    return cb(null, data)\n  })\n}\n\n/**\n * Warn if the bin references don't point to anything.  This might be better in\n * normalize-package-data if it had access to the file path.\n */\nfunction checkBinReferences_ (file, data, warn, cb) {\n  if (!(data.bin instanceof Object)) {\n    return cb()\n  }\n\n  var keys = Object.keys(data.bin)\n  var keysLeft = keys.length\n  if (!keysLeft) {\n    return cb()\n  }\n\n  function handleExists (relName, result) {\n    keysLeft--\n    if (!result) {\n      warn('No bin file found at ' + relName)\n    }\n    if (!keysLeft) {\n      cb()\n    }\n  }\n\n  keys.forEach(function (key) {\n    var dirName = path.dirname(file)\n    var relName = data.bin[key]\n    /* istanbul ignore if - impossible, bins have been normalized */\n    if (typeof relName !== 'string') {\n      var msg = 'Bin filename for ' + key +\n        ' is not a string: ' + util.inspect(relName)\n      warn(msg)\n      delete data.bin[key]\n      handleExists(relName, true)\n      return\n    }\n    var binPath = path.resolve(dirName, relName)\n    fs.stat(binPath, (err) => handleExists(relName, !err))\n  })\n}\n\nfunction final (file, data, log, strict, cb) {\n  var pId = makePackageId(data)\n\n  function warn (msg) {\n    if (typoWarned[pId]) {\n      return\n    }\n    if (log) {\n      log('package.json', pId, msg)\n    }\n  }\n\n  try {\n    normalizeData(data, warn, strict)\n  } catch (error) {\n    return cb(error)\n  }\n\n  checkBinReferences_(file, data, warn, function () {\n    typoWarned[pId] = true\n    cb(null, data)\n  })\n}\n\nfunction fillTypes (file, data, cb) {\n  var index = data.main ? data.main : 'index.js'\n\n  // TODO exports is much more complicated than this in verbose format\n  // We need to support for instance\n\n  // \"exports\": {\n  //   \".\": [\n  //     {\n  //       \"default\": \"./lib/npm.js\"\n  //     },\n  //     \"./lib/npm.js\"\n  //   ],\n  //   \"./package.json\": \"./package.json\"\n  // },\n  // as well as conditional exports\n\n  // if (data.exports && typeof data.exports === 'string') {\n  //   index = data.exports\n  // }\n\n  // if (data.exports && data.exports['.']) {\n  //   index = data.exports['.']\n  //   if (typeof index !== 'string') {\n  //   }\n  // }\n\n  var extless =\n    path.join(path.dirname(index), path.basename(index, path.extname(index)))\n  var dts = `./${extless}.d.ts`\n  var dtsPath = path.join(path.dirname(file), dts)\n  var hasDTSFields = 'types' in data || 'typings' in data\n  if (!hasDTSFields && fs.existsSync(dtsPath)) {\n    data.types = dts\n  }\n\n  cb(null, data)\n}\n\nfunction makePackageId (data) {\n  var name = cleanString(data.name)\n  var ver = cleanString(data.version)\n  return name + '@' + ver\n}\n\nfunction cleanString (str) {\n  return (!str || typeof (str) !== 'string') ? '' : str.trim()\n}\n\n// /**package { \"name\": \"foo\", \"version\": \"1.2.3\", ... } **/\nfunction parseIndex (data) {\n  data = data.split(/^\\/\\*\\*package(?:\\s|$)/m)\n\n  if (data.length < 2) {\n    return null\n  }\n  data = data[1]\n  data = data.split(/\\*\\*\\/$/m)\n\n  if (data.length < 2) {\n    return null\n  }\n  data = data[0]\n  data = data.replace(/^\\s*\\*/mg, '')\n\n  try {\n    return safeJSON(data)\n  } catch (er) {\n    return null\n  }\n}\n\nfunction parseError (ex, file) {\n  var e = new Error('Failed to parse json\\n' + ex.message)\n  e.code = 'EJSONPARSE'\n  e.path = file\n  return e\n}\n"]},"metadata":{},"sourceType":"script"}